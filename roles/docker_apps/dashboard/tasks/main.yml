- name: Ensure configuration and script directories
  become: true
  file:
    path: /docker/{{item}}
    owner: root
    group: docker
    mode: 0775
    state: directory
  with_items:
    - apps/dashboard
    - apps/dashboard/config
  tags:
    - app_directory

- name: Install configuration file
  become: true
  copy:
    src: config/dashboard-config.properties
    dest: /docker/apps/dashboard/config/dashboard-config.properties
    owner: root
    group: docker
    mode: 0664
  tags:
    - app_config
    
- name: Install docker-compose.yml using version
  become: true
  template:
    src: docker-compose.yml
    dest: /docker/apps/dashboard/docker-compose.yml
    owner: root
    group: docker
    mode: 0664
  tags:
    - docker_compose

- name: Deploy stack 
  command: docker stack deploy -c /docker/apps/dashboard/docker-compose.yml dashboard
  tags:
    - deploy
